<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Torneo Sportivo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background-color: #004aad; color: white; padding: 20px; text-align: center; position: relative; }
    header img { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); height: 50px; cursor: pointer; }
    nav { background-color: #eee; padding: 10px; text-align: center; }
    nav a { margin: 0 15px; text-decoration: none; color: #004aad; font-weight: bold; cursor: pointer; }
    section { padding: 20px; display: none; }
    .active { display: block; }
    .login-form, .dashboard { max-width: 500px; margin: auto; }
    input, button, select { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }

    @media (max-width: 600px) {
      header { padding: 10px; font-size: 16px; }
      header img { height: 40px; left: 10px; }
      nav { padding: 5px; font-size: 14px; }
      nav a { display: block; margin: 5px 0; }
      .login-form, .dashboard { width: 95%; padding: 10px; }
      table, th, td { font-size: 12px; padding: 6px; }
      h2, h3 { font-size: 18px; text-align: center; }
      input, button, select { font-size: 14px; padding: 8px; }
    }
  </style>
</head>
<body>

  <header>
    <a href="https://www.facebook.com/groups/297586524369662" target="_blank">
      <img src="logo.png" alt="Logo Torneo" />
    </a>
    <h1>Torneo Sportivo 2025</h1>
  </header>

  <nav>
    <a onclick="showHome()">Home</a>
    <a onclick="showClassifica('calcio')">Classifica Calcio</a>
    <a onclick="showClassifica('pallavolo')">Classifica Pallavolo</a>
    <a onclick="showClassifica('chiosco')">Coppa Chiosco</a>
    <a onclick="showLogin()">Admin</a>
  </nav>

  <section id="home">
    <h2>Partite Calcio</h2>
    <table>
      <thead>
        <tr><th>Squadra 1</th><th>Squadra 2</th><th>Risultato</th></tr>
      </thead>
      <tbody id="matchListCalcio"></tbody>
    </table>
    <h2>Partite Pallavolo</h2>
    <table>
      <thead>
        <tr><th>Squadra 1</th><th>Squadra 2</th><th>Risultato</th></tr>
      </thead>
      <tbody id="matchListPallavolo"></tbody>
    </table>
  </section>

  <section id="classifica">
    <h2 id="titoloClassifica"></h2>
    <table id="scoreboard">
      <thead id="theadScoreboard"></thead>
      <tbody id="tbodyScoreboard"></tbody>
    </table>
    <button onclick="showHome()" style="margin-top: 20px;">Torna alla Home</button>
  </section>

  <section id="login">
    <h2>Login Admin</h2>
    <div class="login-form">
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="login()">Accedi</button>
    </div>
  </section>

  <section id="arbitro">
  <h2>Benvenuto Arbitro</h2>
  <p>Qui puoi vedere e gestire solo le partite senza modificare squadre.</p>
  <div class="dashboard">
    <h3>Partite da Giocare</h3>
    <table>
      <thead><tr><th>Squadra 1</th><th>Squadra 2</th><th>Sport</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<section id="barman">
  <h2>Benvenuto Barman</h2>
  <p>Qui puoi vedere e gestire la coppa chiosco.</p>
  <div class="dashboard">
    <h3>Partite da Giocare</h3>
    <table>
      <thead><tr><th>Squadra 1</th><th>Squadra 2</th><th>Sport</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</section>

  <section id="dashboard">
    <h2>Pannello di Controllo - Gestione Torneo</h2>
    <div class="dashboard">
      <h3>Aggiungi Squadra</h3>
      <input type="text" id="nuovaSquadra" placeholder="Nome squadra" />
      <select id="sportSquadra">
        <option value="calcio">Calcio</option>
        <option value="pallavolo">Pallavolo</option>
      </select>
      <select id="gironeSquadra">
  <option value="A">Girone A</option>
  <option value="B">Girone B</option>
</select>
      <button onclick="aggiungiSquadra()">Aggiungi</button>
      <h3>Modifica o Elimina Squadre</h3>

<select id="selectSquadraGestione"></select>
<input type="text" id="nuovoNomeSquadra" placeholder="Nuovo nome squadra" />
<button onclick="modificaSquadra()">Modifica Nome</button>
<button onclick="eliminaSquadra()">Elimina Squadra</button>

<h3>Elimina Partita</h3>
<select id="selectPartitaElimina"></select>
<button onclick="eliminaPartita()">Elimina Partita</button>

      <h3>Crea Partita</h3>
      <select id="squadra1"></select>
      <select id="squadra2"></select>
      <button onclick="creaPartita()">Crea Partita</button>

      <h3>Inserisci Risultato</h3>
      <select id="match"></select>
      <input type="number" id="gol1" placeholder="Gol/Set Squadra 1" />
      <input type="number" id="gol2" placeholder="Gol/Set Squadra 2" />
      <button onclick="inserisciRisultato()">Inserisci Risultato</button>
      <p id="esitoInserimento" style="color: green; display: none;">Risultato inserito con successo!</p>
    </div>
  </section>

  <section id="classificaChiosco">
    <h2>Classifica Chiosco</h2>
    <table>
      <thead>
        <tr><th>Squadra</th><th>Punti</th></tr>
      </thead>
      <tbody id="tbodyChiosco"></tbody>
    </table>
  </section>

<script>
  const USERS = [
  { username: "admin", password: "1234", ruolo: "admin" },
  { username: "arbitri", password: "1234", ruolo: "arbitro" },
  { username: "chiosco", password: "1234", ruolo: "barman" }
];
  let squadre = JSON.parse(localStorage.getItem("squadre")) || [];
  let partite = JSON.parse(localStorage.getItem("partite")) || [];
  let punteggi = JSON.parse(localStorage.getItem("punteggi")) || {};
  let chiosco= JSON.parse(localStorage.getItem("chiosco")) || {};

  function salvaDati() {
    localStorage.setItem("squadre", JSON.stringify(squadre));
    localStorage.setItem("partite", JSON.stringify(partite));
    localStorage.setItem("punteggi", JSON.stringify(punteggi));
    localStorage.setItem("chiosco", JSON.stringify(chiosco));
  }

  function nascondiTutte() {
    document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
  }

  function showHome() {
    nascondiTutte();
    document.getElementById("home").style.display = "block";
    aggiornaMatchList();
  }

   function showClassifica(sport) {
      nascondiTutte();
      document.getElementById("classifica").style.display = "block";
      if (sport === "chiosco") {
        document.getElementById("classificaChiosco").style.display = "block";
        aggiornaClassificaChiosco();
        document.getElementById("titoloClassifica").textContent = "Classifica Chiosco";
        document.getElementById("scoreboard").style.display = "none";
      } else {
        document.getElementById("classificaChiosco").style.display = "none";
        document.getElementById("scoreboard").style.display = "table";
        document.getElementById("titoloClassifica").textContent = "Classifica " + sport.charAt(0).toUpperCase() + sport.slice(1);
        aggiornaClassifica(sport);
      }
    }

  function showLogin() {
    nascondiTutte();
    document.getElementById("login").style.display = "block";
  }

  function showDashboard() {
    nascondiTutte();
    document.getElementById("dashboard").style.display = "block";
    aggiornaSelectSquadre();
    popolaPartite();
    aggiornaSelectGestione();
  }

  function showRefereePanel() {
  nascondiTutte();
  document.getElementById("arbitro").style.display = "block";

  const tabella = document.querySelector("#arbitro tbody");
  tabella.innerHTML = "";
  partite
    .filter(p => !p.risultato)
    .forEach(p => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${p.squadra1}</td><td>${p.squadra2}</td><td>${p.sport}</td>`;
      tabella.appendChild(row);
    });
}

function showBarPanel() {
  const panel = document.getElementById("panel");
  panel.innerHTML = "<h2>Coppa Chiosco</h2>";

  // Ordina le squadre in base ai puntiBar (decrescente)
  const squadreOrdinate = [...squadre].sort((a, b) => (b.puntiBar || 0) - (a.puntiBar || 0));

  // Mostra tutte le squadre ordinate
  squadreOrdinate.forEach((squadra, index) => {
    const punti = squadra.puntiBar || 0;

    // Crea l'elemento HTML con nome, punti e input per inserire spesa
    const div = document.createElement("div");
    div.innerHTML = `
      <span><strong>${squadra.nome}</strong>: ${punti} punti</span>
      <input type="number" id="spesa-${index}" placeholder="€ spesi" min="0" step="0.01" style="width: 80px; margin-left: 10px;" />
      <button onclick="aggiungiPuntiBarOrdinate(${index})">Aggiungi</button>
    `;
    panel.appendChild(div);
  });

  // Bottone per salvare la classifica aggiornata
  const saveBtn = document.createElement("button");
  saveBtn.textContent = "Salva Classifica Coppa Chiosco";
  saveBtn.onclick = function () {
    localStorage.setItem("squadre", JSON.stringify(squadre));
    alert("Classifica salvata!");
  };
  panel.appendChild(document.createElement("br"));
  panel.appendChild(saveBtn);
}

// Funzione aggiornata che lavora con squadre ordinate
function aggiungiPuntiBarOrdinate(ordIndex) {
  // squadreOrdinate è creata dentro showBarPanel(), quindi la ricreiamo qui per l'indice corretto
  const squadreOrdinate = [...squadre].sort((a, b) => (b.puntiBar || 0) - (a.puntiBar || 0));
  const squadraSelezionata = squadreOrdinate[ordIndex];

  const input = document.getElementById(`spesa-${ordIndex}`);
  const euroSpesi = parseFloat(input.value);

  if (isNaN(euroSpesi) || euroSpesi <= 0) {
    alert("Inserisci un valore valido in euro.");
    return;
  }

  const punti = Math.floor(euroSpesi);

  // Aggiorna i punti della squadra originale (non ordinata)
  const squadraOriginale = squadre.find(s => s.nome === squadraSelezionata.nome);
  squadraOriginale.puntiBar = (squadraOriginale.puntiBar || 0) + punti;

  showBarPanel();
}



  function login() {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;
  const found = USERS.find(u => u.username === user && u.password === pass);

  if (found) {
    if (found.ruolo === "admin") {
      showDashboard();
    } else if (found.ruolo === "arbitro") {
      showRefereePanel();
    } else if (found.ruolo === "barman") {
      showBarPanel();
    }
  } else {
    alert("Credenziali non valide!");
  }
}

  function aggiungiSquadra() {
    const nome = document.getElementById("nuovaSquadra").value.trim();
const sport = document.getElementById("sportSquadra").value;
const girone = document.getElementById("gironeSquadra").value;
    if (!nome) return alert("Inserisci il nome della squadra.");
    if (squadre.find(s => s.nome.toLowerCase() === nome.toLowerCase())) {
      return alert("Squadra già esistente.");
    }
squadre.push({ nome, sport, girone });
    // Inizializza punteggi
    if (sport === "calcio") {
      punteggi[nome] = { punti: 0, gf: 0, gs: 0 };
    } else if (sport === "pallavolo") {
      punteggi[nome] = { punti: 0, sv: 0, sp: 0 };
    }
    salvaDati();
    document.getElementById("nuovaSquadra").value = "";
    aggiornaSelectSquadre();
  }

  function aggiornaClassifica(sport) {
  const thead = document.getElementById("theadScoreboard");
  const tbody = document.getElementById("tbodyScoreboard");
  tbody.innerHTML = "";

  thead.innerHTML = sport === "calcio"
    ? "<tr><th>Girone</th><th>Squadra</th><th>Punti</th><th>GF</th><th>GS</th></tr>"
    : "<tr><th>Girone</th><th>Squadra</th><th>Punti</th><th>Set Vinti</th><th>Set Persi</th></tr>";

  const squadreFiltrate = squadre.filter(s => s.sport === sport);

  // Dividi per girone
  const gironi = { A: [], B: [] };
  for (const s of squadreFiltrate) {
    gironi[s.girone].push(s.nome);
  }

  for (const girone in gironi) {
    const nomiSquadre = gironi[girone];

    nomiSquadre.forEach(nome => {
      const dati = punteggi[nome];
      if (!dati) return;

      const tr = document.createElement("tr");
      if (sport === "calcio") {
        tr.innerHTML = `<td>${girone}</td><td>${nome}</td><td>${dati.punti}</td><td>${dati.gf}</td><td>${dati.gs}</td>`;
      } else {
        tr.innerHTML = `<td>${girone}</td><td>${nome}</td><td>${dati.punti}</td><td>${dati.sv}</td><td>${dati.sp}</td>`;
      }
      tbody.appendChild(tr);
    });
  }
}


  function aggiornaClassificaChiosco() {
      const tbody = document.getElementById("tbodyChiosco");
      tbody.innerHTML = "";
      const entries = Object.entries(chiosco);
      entries.sort((a, b) => b[1] - a[1]);

      for (const [squadra, punti] of entries) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${squadra}</td><td>${punti}</td>`;
        tbody.appendChild(tr);
      }
    }

  function creaPartita() {
    const s1Nome = document.getElementById("squadra1").value;
    const s2Nome = document.getElementById("squadra2").value;
    const s1 = squadre.find(s => s.nome === s1Nome);
    const s2 = squadre.find(s => s.nome === s2Nome);

    if (!s1 || !s2) return alert("Seleziona due squadre valide.");
    if (s1.nome === s2.nome) return alert("Seleziona due squadre diverse.");
    if (s1.sport !== s2.sport) return alert("Le squadre devono appartenere allo stesso sport.");

    partite.push({ id: Date.now(), squadra1: s1.nome, squadra2: s2.nome, sport: s1.sport, risultato: null });
    salvaDati();
    popolaPartite();
    aggiornaMatchList();
  }

  function popolaPartite() {
    const matchSelect = document.getElementById("match");
    matchSelect.innerHTML = "";
    partite.forEach(p => {
      if (p.risultato === null) {
        const option = document.createElement("option");
        option.value = p.id;
        option.textContent = `${p.squadra1} vs ${p.squadra2} (${p.sport})`;
        matchSelect.appendChild(option);
      }
    });
  }
function aggiornaSelectGestione() {
  const gestione = document.getElementById("selectSquadraGestione");
  const partiteElimina = document.getElementById("selectPartitaElimina");

  gestione.innerHTML = "";
  squadre.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s.nome;
    opt.textContent = `${s.nome} (${s.sport})`;
    gestione.appendChild(opt);
  });

  partiteElimina.innerHTML = "";
  partite.forEach(p => {
    const opt = document.createElement("option");
    opt.value = p.id;
    const risultato = p.risultato ? `${p.risultato.gol1}-${p.risultato.gol2}` : "da giocare";
    opt.textContent = `${p.squadra1} vs ${p.squadra2} (${p.sport}) - ${risultato}`;
    partiteElimina.appendChild(opt);
  });
}

function modificaSquadra() {
  const oldName = document.getElementById("selectSquadraGestione").value;
  const newName = document.getElementById("nuovoNomeSquadra").value.trim();
  if (!newName) return alert("Inserisci il nuovo nome.");
  if (oldName === newName) return alert("Il nome è uguale a quello attuale.");

  if (squadre.find(s => s.nome === newName)) return alert("Nome già esistente.");

  // Modifica squadra
  const squadra = squadre.find(s => s.nome === oldName);
  squadra.nome = newName;

  // Aggiorna punteggi
  punteggi[newName] = punteggi[oldName];
  delete punteggi[oldName];

  // Aggiorna partite
  partite.forEach(p => {
    if (p.squadra1 === oldName) p.squadra1 = newName;
    if (p.squadra2 === oldName) p.squadra2 = newName;
  });

  salvaDati();
  aggiornaSelectSquadre();
  aggiornaSelectGestione();
  aggiornaMatchList();
  popolaPartite();
  document.getElementById("nuovoNomeSquadra").value = "";
}

function eliminaSquadra() {
  const nome = document.getElementById("selectSquadraGestione").value;

  if (!confirm(`Sicuro di voler eliminare la squadra "${nome}"?`)) return;

  squadre = squadre.filter(s => s.nome !== nome);
  delete punteggi[nome];
  partite = partite.filter(p => p.squadra1 !== nome && p.squadra2 !== nome);

  salvaDati();
  aggiornaSelectSquadre();
  aggiornaSelectGestione();
  aggiornaMatchList();
  popolaPartite();
}

function eliminaPartita() {
  const id = parseInt(document.getElementById("selectPartitaElimina").value);
  if (!confirm("Sicuro di voler eliminare questa partita?")) return;
  const index = partite.findIndex(p => p.id === id);
  if (index === -1) return;

  // Opzionalmente: annulla i punteggi se la partita aveva già un risultato
  // (Può essere complicato: vuoi che lo faccia anche questo?)

  partite.splice(index, 1);
  salvaDati();
  aggiornaSelectGestione();
  aggiornaMatchList();
  popolaPartite();
}
function inserisciRisultato() {
  const id = parseInt(document.getElementById("match").value);
  const gol1 = parseInt(document.getElementById("gol1").value);
  const gol2 = parseInt(document.getElementById("gol2").value);
  const partita = partite.find(p => p.id === id);
  if (!partita) return alert("Partita non valida.");
  if (partita.risultato !== null) return alert("Risultato già inserito.");
  if (isNaN(gol1) || isNaN(gol2)) return alert("Inserisci valori numerici validi.");

  partita.risultato = { gol1, gol2 };
  const s1 = partita.squadra1;
  const s2 = partita.squadra2;

  if (partita.sport === "calcio") {
    punteggi[s1].gf += gol1;
    punteggi[s1].gs += gol2;
    punteggi[s2].gf += gol2;
    punteggi[s2].gs += gol1;

    if (gol1 > gol2) punteggi[s1].punti += 3;
    else if (gol1 < gol2) punteggi[s2].punti += 3;
    else {
      punteggi[s1].punti += 1;
      punteggi[s2].punti += 1;
    }
  } else if (partita.sport === "pallavolo") {
    punteggi[s1].sv += gol1;
    punteggi[s1].sp += gol2;
    punteggi[s2].sv += gol2;
    punteggi[s2].sp += gol1;

    if (gol1 > gol2) punteggi[s1].punti += 3;
    else punteggi[s2].punti += 3;
  }

  salvaDati();
  popolaPartite();
  aggiornaMatchList();
  aggiornaSelectGestione();
  document.getElementById("esitoInserimento").style.display = "block";
  setTimeout(() => document.getElementById("esitoInserimento").style.display = "none", 3000);
}


  function aggiornaMatchList() {
    const calcio = document.getElementById("matchListCalcio");
    const volley = document.getElementById("matchListPallavolo");
    calcio.innerHTML = "";
    volley.innerHTML = "";

    partite.forEach(p => {
      let risultato = p.risultato ? `${p.risultato.gol1} - ${p.risultato.gol2}` : "Da giocare";
      const riga = `<tr><td>${p.squadra1}</td><td>${p.squadra2}</td><td>${risultato}</td></tr>`;
      if (p.sport === "calcio") calcio.innerHTML += riga;
      else if (p.sport === "pallavolo") volley.innerHTML += riga;
    });
  }

  function aggiornaClassifica(sport) {
    const thead = document.getElementById("theadScoreboard");
    const tbody = document.getElementById("tbodyScoreboard");
    thead.innerHTML = "";
    tbody.innerHTML = "";

    if (sport === "calcio") {
      thead.innerHTML = "<tr><th>Squadra</th><th>Punti</th><th>Gol Fatti</th><th>Gol Subiti</th><th>Differenza Reti</th></tr>";

      const classifica = squadre
        .filter(s => s.sport === sport)
        .map(s => {
          const dati = punteggi[s.nome] || { punti: 0, gf: 0, gs: 0 };
          return {
            nome: s.nome,
            punti: dati.punti,
            gf: dati.gf,
            gs: dati.gs,
            dr: dati.gf - dati.gs
          };
        })
        .sort((a, b) => b.punti - a.punti || b.dr - a.dr);

      classifica.forEach(s => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${s.nome}</td><td>${s.punti}</td><td>${s.gf}</td><td>${s.gs}</td><td>${s.dr}</td>`;
        tbody.appendChild(row);
      });

    } else if (sport === "pallavolo") {
      thead.innerHTML = "<tr><th>Squadra</th><th>Punti</th><th>Set Vinti</th><th>Set Persi</th></tr>";

      const classifica = squadre
        .filter(s => s.sport === sport)
        .map(s => {
          const dati = punteggi[s.nome] || { punti: 0, sv: 0, sp: 0 };
          return {
            nome: s.nome,
            punti: dati.punti,
            sv: dati.sv,
            sp: dati.sp
          };
        })
        .sort((a, b) => b.punti - a.punti || (b.sv - b.sp) - (a.sv - a.sp));

      classifica.forEach(s => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${s.nome}</td><td>${s.punti}</td><td>${s.sv}</td><td>${s.sp}</td>`;
        tbody.appendChild(row);
      });
    }
  }

  // Mostra home all'avvio
  showHome();

</script>

</body>
</html>
